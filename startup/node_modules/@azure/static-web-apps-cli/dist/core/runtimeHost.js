"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createRuntimeHost = void 0;
const config_1 = require("../config");
const runtimes_1 = require("./runtimes");
const utils_1 = require("./utils");
const httpServerBin = utils_1.getBin("http-server");
const createRuntimeHost = ({ appPort, proxyHost, proxyPort, appLocation, appArtifactLocation }) => {
    const runtimeType = runtimes_1.detectRuntime(appLocation);
    console.log(">> detected runtime:", runtimeType);
    switch (runtimeType) {
        // .NET runtime
        case runtimes_1.RuntimeType.dotnet:
            return {
                command: "dotnet",
                args: `watch --project ${appLocation} run --urls=http://${proxyHost}:${appPort}`.split(" "),
            };
        // Node.js runtime or static sites
        case runtimes_1.RuntimeType.node:
        case runtimes_1.RuntimeType.unknown:
        default:
            const command = httpServerBin;
            appArtifactLocation = appArtifactLocation || config_1.DEFAULT_CONFIG.appArtifactLocation;
            // See available options for http-server: https://github.com/http-party/http-server#available-options
            // Note: --proxy allows us to add fallback routes for SPA (https://github.com/http-party/http-server#catch-all-redirect)
            const args = `${appArtifactLocation} -d false --host ${proxyHost} --port ${appPort} --cache -1 --proxy http://${proxyHost}:${proxyPort}/?`.split(" ");
            return {
                command,
                args,
            };
    }
};
exports.createRuntimeHost = createRuntimeHost;
//# sourceMappingURL=runtimeHost.js.map