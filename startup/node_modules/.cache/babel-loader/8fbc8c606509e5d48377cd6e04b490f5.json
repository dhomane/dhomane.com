{"ast":null,"code":"import _regeneratorRuntime from\"/var/www/html/startup/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/var/www/html/startup/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import anime from\"animejs\";import domToImage from\"dom-to-image\";import FileSaver from\"file-saver\";import React,{useEffect}from\"react\";import{useDispatch,useSelector}from\"react-redux\";import Character from\"~/src/components/Character\";import StatGrader from\"~/src/components/StatGrader\";import Floorlight from\"~/src/graphics/floorlight\";import Lightbeam from\"~/src/graphics/lightbeam\";import{characterActions}from\"~/src/redux/character\";import{infoActions}from\"~/src/redux/info\";import{statsActions}from\"~/src/redux/stats\";import{uiActions}from\"~/src/redux/ui\";import{decodeColourSet}from\"~/src/utils/format-character-data\";import ArrowDown from\"../EndScreen/arrow-down\";import{CharacterArea,CharacterCard,CtaArea,EndButton,EndScreenContainer,EndScreenWrapper,PublicUrl,QRCodeContainer,Spinner,SpinnerContainer,Stats}from\"../EndScreen/styles\";var CharacterDisplay=function CharacterDisplay(){var qrUrl=window.location.href;var _useSelector=useSelector(function(store){return store.stats;}),gradedStats=_useSelector.gradedStats;var dispatch=useDispatch();useEffect(function(){var id=window.location.pathname.slice(1);fetch(\"/api/get-character/\".concat(id)).then(function(res){return res.json();}).then(function(_ref){var companyInfo=_ref.companyInfo,stats=_ref.stats,_ref$accessories=_ref.accessories,accessories=_ref$accessories===void 0?[]:_ref$accessories,startedAt=_ref.startedAt,completedAt=_ref.completedAt,appearance=_ref.appearance;// restore company info\ndispatch(infoActions.setBusinessCategory(companyInfo.businessCategory));dispatch(infoActions.setRole(companyInfo.role));dispatch(infoActions.setFunding(companyInfo.funding));dispatch(infoActions.setCompanySize(companyInfo.companySize));// restore stats\nvar _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=stats[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _ref3=_step.value;var level=_ref3.level;var name=_ref3.name;var category=_ref3.category;dispatch(statsActions.addStat({name:name,category:category}));for(var i=0;i<level;i++){dispatch(statsActions.addStatPoint({category:category,name:name,level:level}));}}// restore character\n}catch(err){_didIteratorError=true;_iteratorError=err;}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return();}}finally{if(_didIteratorError){throw _iteratorError;}}}accessories.map(characterActions.setAccessory).map(dispatch);dispatch(characterActions.setStartTime(startedAt));dispatch(characterActions.setShoes(appearance.shoes));dispatch(characterActions.setEyewear(appearance.eyewear));dispatch(characterActions.setHairStyle(appearance.hair.id));dispatch(characterActions.setHairColor(decodeColourSet(appearance.hair.color)));dispatch(characterActions.setFacialHair(appearance.facialHair.id));dispatch(characterActions.setFacialHairColor(decodeColourSet(appearance.facialHair.color)));if(appearance.skin){dispatch(characterActions.setSkinColor(decodeColourSet(appearance.skin)));}if(appearance[\"t-shirt\"]){dispatch(characterActions.setTop(\"t-shirt\",decodeColourSet(appearance[\"t-shirt\"])));}if(appearance[\"shirt\"]){dispatch(characterActions.setTop(\"shirt\",decodeColourSet(appearance[\"shirt\"])));}if(appearance[\"jacket\"]){dispatch(characterActions.setTop(\"jacket\",decodeColourSet(appearance[\"jacket\"])));}if(appearance[\"hoodie\"]){dispatch(characterActions.setTop(\"hoodie\",decodeColourSet(appearance[\"hoodie\"])));}if(appearance[\"bottom-clothes\"]){dispatch(characterActions.setBottom(appearance[\"bottom-clothes\"].id,appearance[\"bottom-clothes\"].color?decodeColourSet(appearance[\"bottom-clothes\"].color):undefined));}// go to the page\ndispatch(uiActions.setIdle(false));dispatch(uiActions.navigateTo(4));anime.set(\".character-container\",{filter:\"brightness(1)\"});anime.set(\".skill-container, .start-button\",{opacity:1});});},[dispatch]);var downloadAvatar=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var characterWrapper,png;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:characterWrapper=document.getElementById(\"character-wrapper\");if(characterWrapper){_context.next=3;break;}return _context.abrupt(\"return\");case 3:_context.next=5;return domToImage.toPng(characterWrapper,{style:{transform:\"none\",opacity:1}});case 5:png=_context.sent;FileSaver.saveAs(png,\"avatar.png\");case 7:case\"end\":return _context.stop();}}},_callee);}));return function downloadAvatar(){return _ref4.apply(this,arguments);};}();var finish=function finish(){dispatch(uiActions.startOver());};useEffect(function(){anime.set(\"#character-area\",{opacity:0});anime.set(\".logo\",{zIndex:-1});anime.set(\"#character-card\",{translateX:750,translateY:-1000,scale:1.2,zIndex:99,opacity:0});anime.set(\"#character-area, .skill-container\",{opacity:1});anime({targets:\"span.flash\",opacity:[1,0],duration:1000,easing:\"linear\"});anime({targets:\".view-quide-text\",opacity:[0,1],translateY:[30,0],easing:\"linear\",duration:500});anime({targets:\"#character-card\",translateY:[-1000,-30],duration:750,easing:\"easeOutExpo\",opacity:[0,1],endDelay:2000,complete:function complete(){anime({targets:\"#character-card\",duration:750,easing:\"easeOutExpo\",complete:function complete(){anime.remove(\"#character-card\");anime.set(\"#character-card\",{translateY:-30,translateX:750,scale:1.2});anime({targets:\"#character-card\",translateX:[750,0],translateY:[-30,0],scale:[1.2,1],duration:750,easing:\"easeOutExpo\"});anime({targets:\".dimmer\",opacity:[1,0],duration:800,easing:\"easeOutExpo\",complete:function complete(){anime.set(\".logo\",{zIndex:9});}});}});}});},[]);return React.createElement(EndScreenWrapper,null,React.createElement(\"p\",{className:\"view-quide-text\"},\"The adventure continues!\"),React.createElement(EndScreenContainer,null,React.createElement(CharacterCard,{id:\"character-card\"},React.createElement(CharacterArea,{id:\"character-area\"},React.createElement(\"div\",{className:\"lights\"},React.createElement(Lightbeam,{className:\"lightbeam\"}),React.createElement(Floorlight,{className:\"floorlight\"})),React.createElement(Character,null)),React.createElement(Stats,null,gradedStats.map(function(stat,index){return React.createElement(StatGrader,{key:\"statitem$$\"+index,stat:stat});}))),React.createElement(CtaArea,null,React.createElement(\"h1\",null,\"Mission accomplished\",React.createElement(\"br\",null),\"Startup Adventurer!\"),React.createElement(\"p\",{className:\"cta-text\"},\"Scan QR code to get your avatar\"),React.createElement(ArrowDown,null),!qrUrl?React.createElement(SpinnerContainer,null,React.createElement(Spinner,null)):React.createElement(React.Fragment,null,React.createElement(PublicUrl,{href:qrUrl,target:\"_blank\"},React.createElement(QRCodeContainer,null,React.createElement(\"img\",{src:\"https://chart.googleapis.com/chart?chs=300x300&cht=qr&chl=\".concat(qrUrl,\"&choe=UTF-8\"),alt:\"QR\"})))),React.createElement(EndButton,{onClick:downloadAvatar},\"Download\"),React.createElement(EndButton,{onClick:finish},\"Finish\")),React.createElement(\"span\",{className:\"dimmer\"})));};export default CharacterDisplay;","map":{"version":3,"sources":["/var/www/html/startup/src/views/Character/index.tsx"],"names":["anime","domToImage","FileSaver","React","useEffect","useDispatch","useSelector","Character","StatGrader","Floorlight","Lightbeam","characterActions","infoActions","statsActions","uiActions","decodeColourSet","ArrowDown","CharacterArea","CharacterCard","CtaArea","EndButton","EndScreenContainer","EndScreenWrapper","PublicUrl","QRCodeContainer","Spinner","SpinnerContainer","Stats","CharacterDisplay","qrUrl","window","location","href","store","stats","gradedStats","dispatch","id","pathname","slice","fetch","then","res","json","companyInfo","accessories","startedAt","completedAt","appearance","setBusinessCategory","businessCategory","setRole","role","setFunding","funding","setCompanySize","companySize","level","name","category","addStat","i","addStatPoint","map","setAccessory","setStartTime","setShoes","shoes","setEyewear","eyewear","setHairStyle","hair","setHairColor","color","setFacialHair","facialHair","setFacialHairColor","skin","setSkinColor","setTop","setBottom","undefined","setIdle","navigateTo","set","filter","opacity","downloadAvatar","characterWrapper","document","getElementById","toPng","style","transform","png","saveAs","finish","startOver","zIndex","translateX","translateY","scale","targets","duration","easing","endDelay","complete","remove","stat","index"],"mappings":"qRAAA,MAAOA,CAAAA,KAAP,KAAkB,SAAlB,CACA,MAAOC,CAAAA,UAAP,KAAuB,cAAvB,CACA,MAAOC,CAAAA,SAAP,KAAsB,YAAtB,CACA,MAAOC,CAAAA,KAAP,EAAgBC,SAAhB,KAAiC,OAAjC,CACA,OAASC,WAAT,CAAsBC,WAAtB,KAAyC,aAAzC,CAEA,MAAOC,CAAAA,SAAP,KAAsB,4BAAtB,CACA,MAAOC,CAAAA,UAAP,KAAuB,6BAAvB,CACA,MAAOC,CAAAA,UAAP,KAAuB,2BAAvB,CACA,MAAOC,CAAAA,SAAP,KAAsB,0BAAtB,CAEA,OAASC,gBAAT,KAAiC,uBAAjC,CACA,OAASC,WAAT,KAA4B,kBAA5B,CACA,OAASC,YAAT,KAA6B,mBAA7B,CACA,OAASC,SAAT,KAA0B,gBAA1B,CACA,OAASC,eAAT,KAAgC,mCAAhC,CACA,MAAOC,CAAAA,SAAP,KAAsB,yBAAtB,CACA,OACEC,aADF,CAEEC,aAFF,CAGEC,OAHF,CAIEC,SAJF,CAKEC,kBALF,CAMEC,gBANF,CAOEC,SAPF,CAQEC,eARF,CASEC,OATF,CAUEC,gBAVF,CAWEC,KAXF,KAYO,qBAZP,CAcA,GAAMC,CAAAA,gBAAgB,CAAG,QAAnBA,CAAAA,gBAAmB,EAAM,CAC7B,GAAMC,CAAAA,KAAK,CAAGC,MAAM,CAACC,QAAP,CAAgBC,IAA9B,CAD6B,iBAEL1B,WAAW,CAAC,SAAC2B,KAAD,QAAwBA,CAAAA,KAAK,CAACC,KAA9B,EAAD,CAFN,CAErBC,WAFqB,cAErBA,WAFqB,CAG7B,GAAMC,CAAAA,QAAkB,CAAG/B,WAAW,EAAtC,CACAD,SAAS,CAAC,UAAM,CACd,GAAMiC,CAAAA,EAAE,CAAGP,MAAM,CAACC,QAAP,CAAgBO,QAAhB,CAAyBC,KAAzB,CAA+B,CAA/B,CAAX,CACAC,KAAK,8BAAuBH,EAAvB,EAAL,CACGI,IADH,CACQ,SAACC,GAAD,QAASA,CAAAA,GAAG,CAACC,IAAJ,EAAT,EADR,EAEGF,IAFH,CAEQ,cAAkF,IAA/EG,CAAAA,WAA+E,MAA/EA,WAA+E,CAAlEV,KAAkE,MAAlEA,KAAkE,uBAA3DW,WAA2D,CAA3DA,WAA2D,2BAA7C,EAA6C,kBAAzCC,SAAyC,MAAzCA,SAAyC,CAA9BC,WAA8B,MAA9BA,WAA8B,CAAjBC,UAAiB,MAAjBA,UAAiB,CACtF;AACAZ,QAAQ,CAACxB,WAAW,CAACqC,mBAAZ,CAAgCL,WAAW,CAACM,gBAA5C,CAAD,CAAR,CACAd,QAAQ,CAACxB,WAAW,CAACuC,OAAZ,CAAoBP,WAAW,CAACQ,IAAhC,CAAD,CAAR,CACAhB,QAAQ,CAACxB,WAAW,CAACyC,UAAZ,CAAuBT,WAAW,CAACU,OAAnC,CAAD,CAAR,CACAlB,QAAQ,CAACxB,WAAW,CAAC2C,cAAZ,CAA2BX,WAAW,CAACY,WAAvC,CAAD,CAAR,CAEA;AAPsF,gGAQtF,kBAAwCtB,KAAxC,oHAA+C,0BAAlCuB,CAAAA,KAAkC,OAAlCA,KAAkC,IAA3BC,CAAAA,IAA2B,OAA3BA,IAA2B,IAArBC,CAAAA,QAAqB,OAArBA,QAAqB,CAC7CvB,QAAQ,CAACvB,YAAY,CAAC+C,OAAb,CAAqB,CAAEF,IAAI,CAAJA,IAAF,CAAQC,QAAQ,CAARA,QAAR,CAArB,CAAD,CAAR,CACA,IAAK,GAAIE,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGJ,KAApB,CAA2BI,CAAC,EAA5B,CAAgC,CAC9BzB,QAAQ,CAACvB,YAAY,CAACiD,YAAb,CAA0B,CAAEH,QAAQ,CAARA,QAAF,CAAYD,IAAI,CAAJA,IAAZ,CAAkBD,KAAK,CAALA,KAAlB,CAA1B,CAAD,CAAR,CACD,CACF,CAED;AAfsF,qMAgBtFZ,WAAW,CAACkB,GAAZ,CAAgBpD,gBAAgB,CAACqD,YAAjC,EAA+CD,GAA/C,CAAmD3B,QAAnD,EACAA,QAAQ,CAACzB,gBAAgB,CAACsD,YAAjB,CAA8BnB,SAA9B,CAAD,CAAR,CACAV,QAAQ,CAACzB,gBAAgB,CAACuD,QAAjB,CAA0BlB,UAAU,CAACmB,KAArC,CAAD,CAAR,CACA/B,QAAQ,CAACzB,gBAAgB,CAACyD,UAAjB,CAA4BpB,UAAU,CAACqB,OAAvC,CAAD,CAAR,CACAjC,QAAQ,CAACzB,gBAAgB,CAAC2D,YAAjB,CAA8BtB,UAAU,CAACuB,IAAX,CAAgBlC,EAA9C,CAAD,CAAR,CACAD,QAAQ,CAACzB,gBAAgB,CAAC6D,YAAjB,CAA8BzD,eAAe,CAACiC,UAAU,CAACuB,IAAX,CAAgBE,KAAjB,CAA7C,CAAD,CAAR,CACArC,QAAQ,CAACzB,gBAAgB,CAAC+D,aAAjB,CAA+B1B,UAAU,CAAC2B,UAAX,CAAsBtC,EAArD,CAAD,CAAR,CACAD,QAAQ,CAACzB,gBAAgB,CAACiE,kBAAjB,CAAoC7D,eAAe,CAACiC,UAAU,CAAC2B,UAAX,CAAsBF,KAAvB,CAAnD,CAAD,CAAR,CAEA,GAAIzB,UAAU,CAAC6B,IAAf,CAAqB,CACnBzC,QAAQ,CAACzB,gBAAgB,CAACmE,YAAjB,CAA8B/D,eAAe,CAACiC,UAAU,CAAC6B,IAAZ,CAA7C,CAAD,CAAR,CACD,CACD,GAAI7B,UAAU,CAAC,SAAD,CAAd,CAA2B,CACzBZ,QAAQ,CAACzB,gBAAgB,CAACoE,MAAjB,CAAwB,SAAxB,CAAmChE,eAAe,CAACiC,UAAU,CAAC,SAAD,CAAX,CAAlD,CAAD,CAAR,CACD,CACD,GAAIA,UAAU,CAAC,OAAD,CAAd,CAAyB,CACvBZ,QAAQ,CAACzB,gBAAgB,CAACoE,MAAjB,CAAwB,OAAxB,CAAiChE,eAAe,CAACiC,UAAU,CAAC,OAAD,CAAX,CAAhD,CAAD,CAAR,CACD,CACD,GAAIA,UAAU,CAAC,QAAD,CAAd,CAA0B,CACxBZ,QAAQ,CAACzB,gBAAgB,CAACoE,MAAjB,CAAwB,QAAxB,CAAkChE,eAAe,CAACiC,UAAU,CAAC,QAAD,CAAX,CAAjD,CAAD,CAAR,CACD,CACD,GAAIA,UAAU,CAAC,QAAD,CAAd,CAA0B,CACxBZ,QAAQ,CAACzB,gBAAgB,CAACoE,MAAjB,CAAwB,QAAxB,CAAkChE,eAAe,CAACiC,UAAU,CAAC,QAAD,CAAX,CAAjD,CAAD,CAAR,CACD,CACD,GAAIA,UAAU,CAAC,gBAAD,CAAd,CAAkC,CAChCZ,QAAQ,CACNzB,gBAAgB,CAACqE,SAAjB,CACEhC,UAAU,CAAC,gBAAD,CAAV,CAA6BX,EAD/B,CAEEW,UAAU,CAAC,gBAAD,CAAV,CAA6ByB,KAA7B,CAAqC1D,eAAe,CAACiC,UAAU,CAAC,gBAAD,CAAV,CAA6ByB,KAA9B,CAApD,CAA2FQ,SAF7F,CADM,CAAR,CAMD,CAED;AACA7C,QAAQ,CAACtB,SAAS,CAACoE,OAAV,CAAkB,KAAlB,CAAD,CAAR,CACA9C,QAAQ,CAACtB,SAAS,CAACqE,UAAV,CAAqB,CAArB,CAAD,CAAR,CAEAnF,KAAK,CAACoF,GAAN,CAAU,sBAAV,CAAkC,CAAEC,MAAM,CAAE,eAAV,CAAlC,EACArF,KAAK,CAACoF,GAAN,CAAU,iCAAV,CAA6C,CAAEE,OAAO,CAAE,CAAX,CAA7C,EACD,CAzDH,EA0DD,CA5DQ,CA4DN,CAAClD,QAAD,CA5DM,CAAT,CA8DA,GAAMmD,CAAAA,cAAc,2FAAG,4JACfC,gBADe,CACIC,QAAQ,CAACC,cAAT,CAAwB,mBAAxB,CADJ,IAGhBF,gBAHgB,uFAOHvF,CAAAA,UAAU,CAAC0F,KAAX,CAAiBH,gBAAjB,CAAmC,CAAEI,KAAK,CAAE,CAAEC,SAAS,CAAE,MAAb,CAAqBP,OAAO,CAAE,CAA9B,CAAT,CAAnC,CAPG,QAOfQ,GAPe,eASrB5F,SAAS,CAAC6F,MAAV,CAAiBD,GAAjB,CAAsB,YAAtB,EATqB,sDAAH,kBAAdP,CAAAA,cAAc,2CAApB,CAYA,GAAMS,CAAAA,MAAM,CAAG,QAATA,CAAAA,MAAS,EAAM,CACnB5D,QAAQ,CAACtB,SAAS,CAACmF,SAAV,EAAD,CAAR,CACD,CAFD,CAIA7F,SAAS,CAAC,UAAM,CACdJ,KAAK,CAACoF,GAAN,CAAU,iBAAV,CAA6B,CAAEE,OAAO,CAAE,CAAX,CAA7B,EACAtF,KAAK,CAACoF,GAAN,CAAU,OAAV,CAAmB,CAAEc,MAAM,CAAE,CAAC,CAAX,CAAnB,EACAlG,KAAK,CAACoF,GAAN,CAAU,iBAAV,CAA6B,CAC3Be,UAAU,CAAE,GADe,CAE3BC,UAAU,CAAE,CAAC,IAFc,CAG3BC,KAAK,CAAE,GAHoB,CAI3BH,MAAM,CAAE,EAJmB,CAK3BZ,OAAO,CAAE,CALkB,CAA7B,EAOAtF,KAAK,CAACoF,GAAN,CAAU,mCAAV,CAA+C,CAAEE,OAAO,CAAE,CAAX,CAA/C,EAEAtF,KAAK,CAAC,CACJsG,OAAO,CAAE,YADL,CAEJhB,OAAO,CAAE,CAAC,CAAD,CAAI,CAAJ,CAFL,CAGJiB,QAAQ,CAAE,IAHN,CAIJC,MAAM,CAAE,QAJJ,CAAD,CAAL,CAOAxG,KAAK,CAAC,CACJsG,OAAO,CAAE,kBADL,CAEJhB,OAAO,CAAE,CAAC,CAAD,CAAI,CAAJ,CAFL,CAGJc,UAAU,CAAE,CAAC,EAAD,CAAK,CAAL,CAHR,CAIJI,MAAM,CAAE,QAJJ,CAKJD,QAAQ,CAAE,GALN,CAAD,CAAL,CAQAvG,KAAK,CAAC,CACJsG,OAAO,CAAE,iBADL,CAEJF,UAAU,CAAE,CAAC,CAAC,IAAF,CAAQ,CAAC,EAAT,CAFR,CAGJG,QAAQ,CAAE,GAHN,CAIJC,MAAM,CAAE,aAJJ,CAKJlB,OAAO,CAAE,CAAC,CAAD,CAAI,CAAJ,CALL,CAMJmB,QAAQ,CAAE,IANN,CAQJC,QAAQ,CAAE,mBAAM,CACd1G,KAAK,CAAC,CACJsG,OAAO,CAAE,iBADL,CAEJC,QAAQ,CAAE,GAFN,CAGJC,MAAM,CAAE,aAHJ,CAKJE,QAAQ,CAAE,mBAAM,CACd1G,KAAK,CAAC2G,MAAN,CAAa,iBAAb,EACA3G,KAAK,CAACoF,GAAN,CAAU,iBAAV,CAA6B,CAAEgB,UAAU,CAAE,CAAC,EAAf,CAAmBD,UAAU,CAAE,GAA/B,CAAoCE,KAAK,CAAE,GAA3C,CAA7B,EAEArG,KAAK,CAAC,CACJsG,OAAO,CAAE,iBADL,CAEJH,UAAU,CAAE,CAAC,GAAD,CAAM,CAAN,CAFR,CAGJC,UAAU,CAAE,CAAC,CAAC,EAAF,CAAM,CAAN,CAHR,CAIJC,KAAK,CAAE,CAAC,GAAD,CAAM,CAAN,CAJH,CAKJE,QAAQ,CAAE,GALN,CAMJC,MAAM,CAAE,aANJ,CAAD,CAAL,CASAxG,KAAK,CAAC,CACJsG,OAAO,CAAE,SADL,CAEJhB,OAAO,CAAE,CAAC,CAAD,CAAI,CAAJ,CAFL,CAGJiB,QAAQ,CAAE,GAHN,CAIJC,MAAM,CAAE,aAJJ,CAKJE,QAAQ,CAAE,mBAAM,CACd1G,KAAK,CAACoF,GAAN,CAAU,OAAV,CAAmB,CAAEc,MAAM,CAAE,CAAV,CAAnB,EACD,CAPG,CAAD,CAAL,CASD,CA3BG,CAAD,CAAL,CA6BD,CAtCG,CAAD,CAAL,CAwCD,CAnEQ,CAmEN,EAnEM,CAAT,CAqEA,MACE,qBAAC,gBAAD,MACE,yBAAG,SAAS,CAAC,iBAAb,6BADF,CAEE,oBAAC,kBAAD,MACE,oBAAC,aAAD,EAAe,EAAE,CAAC,gBAAlB,EACE,oBAAC,aAAD,EAAe,EAAE,CAAC,gBAAlB,EACE,2BAAK,SAAS,CAAC,QAAf,EACE,oBAAC,SAAD,EAAW,SAAS,CAAC,WAArB,EADF,CAEE,oBAAC,UAAD,EAAY,SAAS,CAAC,YAAtB,EAFF,CADF,CAKE,oBAAC,SAAD,MALF,CADF,CAQE,oBAAC,KAAD,MACG/D,WAAW,CAAC4B,GAAZ,CAAgB,SAAC6C,IAAD,CAAOC,KAAP,QACf,qBAAC,UAAD,EAAY,GAAG,CAAE,aAAeA,KAAhC,CAAuC,IAAI,CAAED,IAA7C,EADe,EAAhB,CADH,CARF,CADF,CAeE,oBAAC,OAAD,MACE,qDAEE,8BAFF,uBADF,CAME,yBAAG,SAAS,CAAC,UAAb,oCANF,CAOE,oBAAC,SAAD,MAPF,CAQG,CAAC/E,KAAD,CACC,oBAAC,gBAAD,MACE,oBAAC,OAAD,MADF,CADD,CAKC,wCACE,oBAAC,SAAD,EAAW,IAAI,CAAEA,KAAjB,CAAwB,MAAM,CAAC,QAA/B,EACE,oBAAC,eAAD,MACE,2BAAK,GAAG,qEAA+DA,KAA/D,eAAR,CAA2F,GAAG,CAAC,IAA/F,EADF,CADF,CADF,CAbJ,CAqBE,oBAAC,SAAD,EAAW,OAAO,CAAE0D,cAApB,aArBF,CAsBE,oBAAC,SAAD,EAAW,OAAO,CAAES,MAApB,WAtBF,CAfF,CAuCE,4BAAM,SAAS,CAAC,QAAhB,EAvCF,CAFF,CADF,CA8CD,CArMD,CAuMA,cAAepE,CAAAA,gBAAf","sourcesContent":["import anime from \"animejs\";\nimport domToImage from \"dom-to-image\";\nimport FileSaver from \"file-saver\";\nimport React, { useEffect } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { Dispatch } from \"redux\";\nimport Character from \"~/src/components/Character\";\nimport StatGrader from \"~/src/components/StatGrader\";\nimport Floorlight from \"~/src/graphics/floorlight\";\nimport Lightbeam from \"~/src/graphics/lightbeam\";\nimport { IStoreState } from \"~/src/interfaces/IStoreState\";\nimport { characterActions } from \"~/src/redux/character\";\nimport { infoActions } from \"~/src/redux/info\";\nimport { statsActions } from \"~/src/redux/stats\";\nimport { uiActions } from \"~/src/redux/ui\";\nimport { decodeColourSet } from \"~/src/utils/format-character-data\";\nimport ArrowDown from \"../EndScreen/arrow-down\";\nimport {\n  CharacterArea,\n  CharacterCard,\n  CtaArea,\n  EndButton,\n  EndScreenContainer,\n  EndScreenWrapper,\n  PublicUrl,\n  QRCodeContainer,\n  Spinner,\n  SpinnerContainer,\n  Stats,\n} from \"../EndScreen/styles\";\n\nconst CharacterDisplay = () => {\n  const qrUrl = window.location.href;\n  const { gradedStats } = useSelector((store: IStoreState) => store.stats);\n  const dispatch: Dispatch = useDispatch();\n  useEffect(() => {\n    const id = window.location.pathname.slice(1);\n    fetch(`/api/get-character/${id}`)\n      .then((res) => res.json())\n      .then(({ companyInfo, stats, accessories = [], startedAt, completedAt, appearance }) => {\n        // restore company info\n        dispatch(infoActions.setBusinessCategory(companyInfo.businessCategory));\n        dispatch(infoActions.setRole(companyInfo.role));\n        dispatch(infoActions.setFunding(companyInfo.funding));\n        dispatch(infoActions.setCompanySize(companyInfo.companySize));\n\n        // restore stats\n        for (const { level, name, category } of stats) {\n          dispatch(statsActions.addStat({ name, category }));\n          for (let i = 0; i < level; i++) {\n            dispatch(statsActions.addStatPoint({ category, name, level }));\n          }\n        }\n\n        // restore character\n        accessories.map(characterActions.setAccessory).map(dispatch);\n        dispatch(characterActions.setStartTime(startedAt));\n        dispatch(characterActions.setShoes(appearance.shoes));\n        dispatch(characterActions.setEyewear(appearance.eyewear));\n        dispatch(characterActions.setHairStyle(appearance.hair.id));\n        dispatch(characterActions.setHairColor(decodeColourSet(appearance.hair.color)));\n        dispatch(characterActions.setFacialHair(appearance.facialHair.id));\n        dispatch(characterActions.setFacialHairColor(decodeColourSet(appearance.facialHair.color)));\n\n        if (appearance.skin) {\n          dispatch(characterActions.setSkinColor(decodeColourSet(appearance.skin)));\n        }\n        if (appearance[\"t-shirt\"]) {\n          dispatch(characterActions.setTop(\"t-shirt\", decodeColourSet(appearance[\"t-shirt\"])));\n        }\n        if (appearance[\"shirt\"]) {\n          dispatch(characterActions.setTop(\"shirt\", decodeColourSet(appearance[\"shirt\"])));\n        }\n        if (appearance[\"jacket\"]) {\n          dispatch(characterActions.setTop(\"jacket\", decodeColourSet(appearance[\"jacket\"])));\n        }\n        if (appearance[\"hoodie\"]) {\n          dispatch(characterActions.setTop(\"hoodie\", decodeColourSet(appearance[\"hoodie\"])));\n        }\n        if (appearance[\"bottom-clothes\"]) {\n          dispatch(\n            characterActions.setBottom(\n              appearance[\"bottom-clothes\"].id,\n              appearance[\"bottom-clothes\"].color ? decodeColourSet(appearance[\"bottom-clothes\"].color) : undefined\n            )\n          );\n        }\n\n        // go to the page\n        dispatch(uiActions.setIdle(false));\n        dispatch(uiActions.navigateTo(4));\n\n        anime.set(\".character-container\", { filter: \"brightness(1)\" });\n        anime.set(\".skill-container, .start-button\", { opacity: 1 });\n      });\n  }, [dispatch]);\n\n  const downloadAvatar = async () => {\n    const characterWrapper = document.getElementById(\"character-wrapper\");\n\n    if (!characterWrapper) {\n      return;\n    }\n\n    const png = await domToImage.toPng(characterWrapper, { style: { transform: \"none\", opacity: 1 } });\n\n    FileSaver.saveAs(png, \"avatar.png\");\n  };\n\n  const finish = () => {\n    dispatch(uiActions.startOver());\n  };\n\n  useEffect(() => {\n    anime.set(\"#character-area\", { opacity: 0 });\n    anime.set(\".logo\", { zIndex: -1 });\n    anime.set(\"#character-card\", {\n      translateX: 750,\n      translateY: -1000,\n      scale: 1.2,\n      zIndex: 99,\n      opacity: 0,\n    });\n    anime.set(\"#character-area, .skill-container\", { opacity: 1 });\n\n    anime({\n      targets: \"span.flash\",\n      opacity: [1, 0],\n      duration: 1000,\n      easing: \"linear\",\n    });\n\n    anime({\n      targets: \".view-quide-text\",\n      opacity: [0, 1],\n      translateY: [30, 0],\n      easing: \"linear\",\n      duration: 500,\n    });\n\n    anime({\n      targets: \"#character-card\",\n      translateY: [-1000, -30],\n      duration: 750,\n      easing: \"easeOutExpo\",\n      opacity: [0, 1],\n      endDelay: 2000,\n\n      complete: () => {\n        anime({\n          targets: \"#character-card\",\n          duration: 750,\n          easing: \"easeOutExpo\",\n\n          complete: () => {\n            anime.remove(\"#character-card\");\n            anime.set(\"#character-card\", { translateY: -30, translateX: 750, scale: 1.2 });\n\n            anime({\n              targets: \"#character-card\",\n              translateX: [750, 0],\n              translateY: [-30, 0],\n              scale: [1.2, 1],\n              duration: 750,\n              easing: \"easeOutExpo\",\n            });\n\n            anime({\n              targets: \".dimmer\",\n              opacity: [1, 0],\n              duration: 800,\n              easing: \"easeOutExpo\",\n              complete: () => {\n                anime.set(\".logo\", { zIndex: 9 });\n              },\n            });\n          },\n        });\n      },\n    });\n  }, []);\n\n  return (\n    <EndScreenWrapper>\n      <p className=\"view-quide-text\">The adventure continues!</p>\n      <EndScreenContainer>\n        <CharacterCard id=\"character-card\">\n          <CharacterArea id=\"character-area\">\n            <div className=\"lights\">\n              <Lightbeam className=\"lightbeam\" />\n              <Floorlight className=\"floorlight\" />\n            </div>\n            <Character />\n          </CharacterArea>\n          <Stats>\n            {gradedStats.map((stat, index: number) => (\n              <StatGrader key={\"statitem$$\" + index} stat={stat} />\n            ))}\n          </Stats>\n        </CharacterCard>\n        <CtaArea>\n          <h1>\n            Mission accomplished\n            <br />\n            Startup Adventurer!\n          </h1>\n          <p className=\"cta-text\">Scan QR code to get your avatar</p>\n          <ArrowDown />\n          {!qrUrl ? (\n            <SpinnerContainer>\n              <Spinner />\n            </SpinnerContainer>\n          ) : (\n            <>\n              <PublicUrl href={qrUrl} target=\"_blank\">\n                <QRCodeContainer>\n                  <img src={`https://chart.googleapis.com/chart?chs=300x300&cht=qr&chl=${qrUrl}&choe=UTF-8`} alt=\"QR\" />\n                </QRCodeContainer>\n              </PublicUrl>\n            </>\n          )}\n          <EndButton onClick={downloadAvatar}>Download</EndButton>\n          <EndButton onClick={finish}>Finish</EndButton>\n        </CtaArea>\n        <span className=\"dimmer\" />\n      </EndScreenContainer>\n    </EndScreenWrapper>\n  );\n};\n\nexport default CharacterDisplay;\n"]},"metadata":{},"sourceType":"module"}